<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		
		<meta name="description" content="I ❤️ Datasette">
  		<meta name="keywords" content="Ray Voelker, PyOhio, PyOhio 2021, PyOhio2021, Datasette, Python, SQL">
  		<meta name="author" content="Ray Voelker">

		<title>Ray Voelker - OH-IUG 2021 - Collection Analysis for $5 a Month. CHEAP!</title>
		
		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/black.css" id="theme">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">
		
		<!-- mad font-->
		<link href="css/stylesheet.css" rel="stylesheet">

	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section data-background="white">
					<img src='img/ohiug-logo.png' style="height: 150px; margin: 0 auto auto auto; background: transparent;">
					<div class="font-container" style="font-family: 'MADFONT'; font-weight: normal; font-style: normal;">
						<p style="font-size: 45px;">Collection Analysis <br />for $5 a Month. <span style="color: #ea454b;">CHEAP</span></p>
					</div>

					<p>
						<a style="font-size: 32px" href="https://rayvoelker.github.io/oh-iug-2021/collection_analysis_for_cheap/index.html">https://rayvoelker.github.io/oh-iug-2021/collection_analysis_for_cheap</a>
					</p>
					
					<p style="font-size: 30px;">
						Ray Voelker<br />
						ray.voelker@gmail.com | ray.voelker@cincinnatilibrary.org<br />
						<img class="r-stretch" style="margin: 0 auto auto auto; height: 250px;" src="img/chpl_logo.png">
						<!-- style="height: 200px; margin: 0 auto auto auto; background: transparent;" -->
					</p>
				</section>
				<section>
					<h2>Talk Overview</h2>
					<ol>
						<li>Collection Analysis Platform Overview</li>
						<li class="fragment">Collection Snapshot Creation: Overview of the workflow and automation involved in extracting the collection metadata from the ILS (Sierra)</li>
						<li class="fragment">The Analysis!</li>
						
					</ol>
				</section>
				<section data-background="white">
					<h2 style="text-transform: none; ">Collection Analysis Platform Overview</h2> 
					<p class="fragment">What is Datasette?</p>

					<p>
						<ul>
							<li class="fragment">
								Datasette is described by its creator, Simon Willison, as "a tool for exploring and publishing data".
							</li> 
							<li class="fragment">
								“Datasette is aimed at 
								<span style="color: firebrick">journalists</span>, 
								<span style="color: firebrick">museum curators</span>,
								<span style="color: firebrick">archivists</span>,
								<span style="color: firebrick">local governments</span> and 
								<span style="color: firebrick "><u>anyone else who has data</u> that they wish to share with the world</span>.”
							</li>
						</ul>
					</p>
				</section>
				<section>
					<h2>Simon's Datasette Presentations / Demos</h2>					
					<ul>
						<li>
							“Introduction to Datasette and sqlite-utils”<br />
							<a href="https://www.youtube.com/watch?v=7kDFBnXaw-c">https://www.youtube.com/watch?v=7kDFBnXaw-c</a>
						</li>
						<li>
							“Simon Willison - Instant serverless APIs, powered by SQLite - PyCon 2019”<br />
							<a href="https://www.youtube.com/watch?v=pTr1uLQTJNE">https://www.youtube.com/watch?v=pTr1uLQTJNE</a>
						</li>
						<li>
							“Keynote: Simon Willson - Datasette and Dogsheep: Liberating your personal data”
							<a href="https://www.youtube.com/watch?v=UFn82w-97kI">https://www.youtube.com/watch?v=UFn82w-97kI</a>
						</li>							
					</ul>
				</section>

				<section>
					<h2 style="text-transform: none;">Things I ❤️ about Datasette</h2>
					<ul>
						<li class="fragment">Written in Python / Available via pip</li>
						<li class="fragment">Easy and intuitive to use</li>
						<li class="fragment">Well-documented</li>
						<li class="fragment">Useful, Large, and growing plugin library</li>
						<li class="fragment">Built-in API... <span class="fragment"> Using SQL!</span></li>
						<li class="fragment">Open source + supportive developer</li>
						<li class="fragment">Flexible deployment with scale-to-zero-cost / free hosting options in mind <br />
							<span class="fragment">... or, <span class="font-container" style="font-family: 'MADFONT'; font-weight: normal; font-style: normal; color: #ea454b;" >CHEAP</span> hosting options</span></li>
					</ul>
				</section>

				<section>
					<h2 style="text-transform: none;">Cincinnati & Hamilton County Public Library: Collection Analysis</h2>
					<a href="https://ilsweb.cincinnatilibrary.org/collection-analysis/">https://ilsweb.cincinnatilibrary.org/collection-analysis/</a>

				</section>

				<section
					data-background="white"
					data-background-iframe="https://ilsweb.cincinnatilibrary.org/collection-analysis/"
					data-background-interactive>
				</section>

				<section>
					<h2>Datasette Deployment / Hosting Options</h2>
					<ul>
						<li class="fragment">There are lots of ways to deploy Datasette <br />(Datasette even has a built in command <code>datasette publish</code> that can package and deploy to services like Heroku or Google Cloud)</li>
					</ul>
				</section>

				<section>
					<h2>Datasette Deployment / Hosting Options</h2>
					<p><a href="https://docs.datasette.io/en/stable/deploying.html#deployment-fundamentals">https://docs.datasette.io/en/stable/deploying.html#deployment-fundamentals</a></p>
					<ul>
						<li class="fragment">Running Datasette on a full Linux server has a lot of advantages, but does have a steep learning curve</li>
						<li class="fragment">Luckily there are lots of help-pages, tutorials, and guides available!</li>
					</ul>
				</section>

				<section>
					<h2>DigitalOcean Droplet (Virtual Private Server)</h2>
					<ul>
						<li class="fragment">
							<span class="font-container" style="font-family: 'MADFONT'; font-weight: normal; font-style: normal; color: #ea454b;">CHEAP</span>
							<br />$5 per month for a 1 CPU / 1 GB memory / 25 GB Disk Linux Server (plenty for Datasette)
						</li>
						<li class="fragment">DigitalOcean has a great community forum with many great guides available for various System Administration tasks</li>
					</ul>
				</section>

				<section>
					<h2 style="text-transform: none;">Create DigitalOcean Droplet for Datasette Step by Step</h2>
						<a href="https://ils-underground.github.io/python_datasette_vps.html">https://ils-underground.github.io/python_datasette_vps.html</a>			
				</section>

				<section>
					<h2 style="text-transform: none;">2. Collection Snapshot Creation</h2>
				</section>

				<section>
					<h2 style="text-transform: none;">Extracting and Building the Data</h2>
					<p> Scripts For Extracting Data From ILS (Sierra)<br /><a style="font-size: smaller;" href="https://github.com/cincinnatilibrary/collection-analysis">https://github.com/cincinnatilibrary/collection-analysis</a></p>
					<ul>
						<li>This was originally done to support the task of automating data extraction from the ILS for the CollectionHQ Service</li>
						<li class="fragment">We don't have to use CollectionHQ--Datasette can act as our data-analysis tool</li>
					</ul>
				</section>

				<section>
					<h2 style="text-transform: none;">3. The Analysis!</h2>
				</section>


				<section >
					<h2 style="text-transform: none;">Looking at Data in Aggregate</h2>
					<ul>
						<li class="fragment">What item locations are defined?</li>
						<li class="fragment"> ... and how many items in each of those locations?</li>
					</ul>
				</section>

				<section
					data-background="white"
					data-background-iframe="https://ilsweb.cincinnatilibrary.org/collection-analysis/current_collection?sql=select%0D%0A++distinct+item.location_code%0D%0Afrom%0D%0A++item"
					data-background-interactive> 
				</section>

				<section
					data-background="white"
					data-background-iframe="https://ilsweb.cincinnatilibrary.org/collection-analysis/current_collection?sql=select%0D%0A++distinct+item.location_code%2C%0D%0A++location_name.name+as+location_name%2C%0D%0A++branch_name.name+as+branch_name%0D%0Afrom%0D%0A++--+it+can+be+handy+to+document+things+like+these+complex+relationships%0D%0A++--+https%3A%2F%2Filsweb.cincinnatilibrary.org%2Fcollection-analysis-docs%2Fdatabase_tables.html%23location-table-location-name-table-branch-table-branch-name-table-relationship%0D%0A++item%0D%0A++left+join+location+on+location.code+%3D+item.location_code%0D%0A++left+join+location_name+on+location_name.location_id+%3D+location.id%0D%0A++left+join+branch+on+branch.code_num+%3D+location.branch_code_num%0D%0A++left+join+branch_name+on+branch_name.branch_id+%3D+branch.id"
					data-background-interactive> 
				</section>

				<section
					data-background="white"
					data-background-iframe="https://ilsweb.cincinnatilibrary.org/collection-analysis/current_collection?sql=select%0D%0A++distinct+item.location_code%2C%0D%0A++location_name.name+as+location_name%2C%0D%0A++branch_name.name+as+branch_name%2C%0D%0A++count(*)+as+count%0D%0Afrom%0D%0A++--+it+can+be+handy+to+document+things+like+these+complex+relationships%0D%0A++--+https%3A%2F%2Filsweb.cincinnatilibrary.org%2Fcollection-analysis-docs%2Fdatabase_tables.html%23location-table-location-name-table-branch-table-branch-name-table-relationship%0D%0A++item%0D%0A++left+join+location+on+location.code+%3D+item.location_code%0D%0A++left+join+location_name+on+location_name.location_id+%3D+location.id%0D%0A++left+join+branch+on+branch.code_num+%3D+location.branch_code_num%0D%0A++left+join+branch_name+on+branch_name.branch_id+%3D+branch.id%0D%0Agroup+by%0D%0A++1%2C%0D%0A++2%2C%0D%0A++3"
					data-background-interactive> 
				</section>

				<section
					data-background="white"
					data-background-iframe="https://ilsweb.cincinnatilibrary.org/collection-analysis/current_collection-f8abe08?sql=select%0D%0A++distinct+item.location_code%2C%0D%0A++location_name.name+as+location_name%2C%0D%0A++branch_name.name+as+branch_name%2C%0D%0A++count%28*%29+as+count%2C%0D%0A++%28%0D%0A++++%27https%3A%2F%2Filsweb.cincinnatilibrary.org%2Fcollection-analysis%2Fcurrent_collection-f8abe08%3Fsql%3Dselect%250D%250A%2B%2B*%250D%250Afrom%250D%250A%2B%2Bitem%250D%250Awhere%250D%250A%2B%2Bitem.location_code%2B%253D%2B%253Alocation_code%26location_code%3D%27+%7C%7C+item.location_code%0D%0A++%29+as+items_link%0D%0Afrom%0D%0A++--+it+can+be+handy+to+document+things+like+these+complex+relationships%0D%0A++--+https%3A%2F%2Filsweb.cincinnatilibrary.org%2Fcollection-analysis-docs%2Fdatabase_tables.html%23location-table-location-name-table-branch-table-branch-name-table-relationship%0D%0A++item%0D%0A++left+join+location+on+location.code+%3D+item.location_code%0D%0A++left+join+location_name+on+location_name.location_id+%3D+location.id%0D%0A++left+join+branch+on+branch.code_num+%3D+location.branch_code_num%0D%0A++left+join+branch_name+on+branch_name.branch_id+%3D+branch.id%0D%0Agroup+by%0D%0A++1%2C%0D%0A++2%2C%0D%0A++3"
					data-background-interactive> 
				</section>


				<section
					<ul>
						<li>
							Datasette Plugin: 
							<span style="color: firebrick">Vega</span> 
							-- A Datasette plugin that provides tools for generating charts using Vega
						</li>						
					</ul>
				</section>

				<section
					data-background="white"
					data-background-iframe="https://ilsweb.cincinnatilibrary.org/collection-analysis/current_collection?sql=SELECT%0D%0A++CAST%28ROUND%28publish_year+%2F+10%2C+1%29+%2A+10+as+INTEGER%29+AS+decade%2C%0D%0ACOUNT%28%2A%29+AS+total%0D%0AFROM%0D%0A++bib%0D%0AWHERE%0D%0A++publish_year+%3E%3D+1800%0D%0A++AND+publish_year+%3C%3D+2021%0D%0AGROUP+BY%0D%0A++decade%0D%0AORDER+BY%0D%0A++decade%3B#g.mark=bar&g.x_column=total&g.x_type=quantitative&g.y_column=decade&g.y_type=ordinal"
					data-background-interactive>
				</section>

				<section>
					<p>
						Named parameters: Datasette provides a nice interface when a named parameter is placed within a SQL query
					</p>
					
				</section>

				<section>
					<pre>
						<code class="sql" data-trim data-line-numbers="7">
select
  bib.*
from
  bib
where
  indexed_subjects like '%' 
  || :subject 
  || '%'
						</code>
					</pre>			
				</section>

				<section
					data-background="white"
					data-background-iframe="https://ilsweb.cincinnatilibrary.org/collection-analysis/current_collection-3d4a4b7?sql=select%0D%0A++bib.*%2C%0D%0A++%28%0D%0A++++select%0D%0A++++++sum%28checkout_total%29%0D%0A++++from%0D%0A++++++item%0D%0A++++where%0D%0A++++++item.bib_record_num+%3D+bib.bib_record_num%0D%0A++%29+as+total_checkouts%2C%0D%0A++%27https%3A%2F%2Fcincinnatilibrary.bibliocommons.com%2Fitem%2Fshow%2F%27+%7C%7C+bib.bib_record_num+%7C%7C+%27170%27+as+catalog_link%0D%0Afrom%0D%0A++bib%0D%0Awhere%0D%0A++indexed_subjects+like+%27%25%27+%0D%0A++%7C%7C+%3Asubject+%0D%0A++%7C%7C+%27%25%27%0D%0Aorder+by%0D%0A++total_checkouts+DESC&subject=dystopias"
					data-background-interactive>
				</section>
				
				<section>
					<h3>Canned Queries</h3>
					<ul>
						<li>
							Create something that looks more like a traditional REST API 
						</li>
					</ul>
					<pre>
						<code class="python" data-trim>
# Datasette URI construction
scheme = "https://"
host = "ilsweb.cincinnatilibrary.org"
# path contains the path of the Datasette instance,
# and the name of the database
path = "/collection-analysis/current_collection"
canned_query_path = "/item_lookup_by_barcode"
response_format = '' # '' or '.csv' or '.json'
query_parameter = "?barcode="
query_parameter_value = "A000036107985"

full_request_uri = scheme + host \
    + path + canned_query_path + response_format \
    + query_parameter + query_parameter_value
						</code>
					</pre>
					
				</section>

				<section
					data-background-iframe="https://ilsweb.cincinnatilibrary.org/collection-analysis/current_collection/item_lookup_by_barcode?barcode=A000036107985"
					data-background-interactive>
				</section>
				
				<section data-background="white">
					<img width="250" src='img/ohiug-logo.png'>
					<img width="250" src="img/chpl_logo.png">
										
						<p>
							Thanks, and <u>please</u>, let me know if you come up with any cool queries, ❤️ Datasette as much as I do, or want to use this at your library!
						</p>

						<p>
							Ray Voelker<br/>
							ray.voelker@gmail.com<br/>
							ray.voelker@cincinnatilibrary.org<br />
							
							<!-- style="height: 200px; margin: 0 auto auto auto; background: transparent;" -->
						</p>
				</section>

		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,
				
				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
			Reveal.configure({ pdfSeparateFragments: false });
		</script>
	</body>
</html>
